<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

    <head>
        <title>Actualizar usuario</title>

    </head>
    <body layout:fragment="body">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

        <div class="container text-center col-9">

            <h1 class="mt-5">Datos del usuario</h1>
            <hr>
            <form th:action="@{/Usuario/form}" method="post" th:object="${Usuariodireccion}" enctype="multipart/form-data" class="col-md-12"  onsubmit="return validarCorreosIguales();">

                <div class="row ">
                    <input type="hidden" th:field="*{usuario.idusuario}">

                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="username">Nombre de Usuario:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-vcard"></i></span>
                                <input type="text" class="form-control" placeholder="Nombre de usuario" id="username" name="username" th:field="*{usuario.username}" autocomplete="off" oninput="validarInput(this);" required>
                            </div>  
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="nombre">Nombre:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-file-person"></i></span>
                                <input type="text" class="form-control" placeholder="Nombre"  id="nombre" name="nombre" onkeypress="return sololetras(event, 'lblNombre')" autocomplete="off" th:field="*{usuario.nombre}">
                            </div>
                            <label id="lblNombre" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="apellido_paterno">Apellido Paterno:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-file-person-fill"></i></span>
                                <input type="text" class="form-control" placeholder="Apellido paterno" id="apellido_paterno" name="apellido_paterno" onkeypress="return sololetras(event, 'lblApellidoP')" autocomplete="off" th:field="*{usuario.apellidopaterno}" >
                            </div>
                            <label id="lblApellidoP" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="apellido_materno">Apellido Materno:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-file-person-fill"></i></span>
                                <input type="text" class="form-control" placeholder="Apellido paterno" id="apellido_materno" name="apellido_materno"  onkeypress="return sololetras(event, 'lblApellidoM')" autocomplete="off" th:field="*{usuario.apellidomaterno}">
                            </div>
                            <label id="lblApellidoM" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                        </div>
                    </div>
                </div>
                <div class=" row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="correo">Correo Electrónico:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-mailbox2"></i></span>
                                <input type="email" class="form-control" onkeypress="return sololetras(event, 'lblcorreo')" placeholder="Correo Electronico" id="correo" name="correo"  pattern=".+@gmail\.com" size="40" required autocomplete="off" th:field="*{usuario.email}">
                            </div>
                            <label id="lblApellidoM" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="password">Contraseña:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-incognito"></i></span>
                                <input type="password" class="form-control" placeholder="Contraseña" id="password" name="password" oninput="validarContraseñaInput(this);" th:field="*{usuario.password}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="telefono">Número de Teléfono:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-telephone-fill"></i></span>
                                <input type="tel" class="form-control" placeholder="Numero de Telefono" id="telefono" name="telefono" onkeypress="return solonumeros(event, 'lblnNumeroT')" autocomplete="off" onblur="return numerosLongitud(event, 'lblnlNumeroT')" th:field="*{usuario.telefono}">
                            </div>
                            <label id="lblnNumeroT" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                            <label id="lblnlNumeroT" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="celular">Número de Celular:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-telephone-plus-fill"></i></span>
                                <input type="tel" class="form-control" placeholder="Numero de Celular" id="celular" name="celular" autocomplete="off"
                                       onkeypress="return solonumeros(event, 'lblnNumeroC')" onblur="return numerosLongitud(event, 'lblnlNumeroC')"
                                       th:field="*{usuario.celular}">
                            </div>
                            <label id="lblnNumeroC" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>

                            <label id="lblnlNumeroC" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>

                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
                            <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" th:field="*{usuario.fechanacimiento}">
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="genero">Género:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-gender-ambiguous"></i></span>
                                <div class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-primary active">
                                        <!--th:checked="${usuario.genero == 'H'}"-->
                                        <input type="radio" name="genero" id="genero_hombre" autocomplete="off" th:value="H" checked th:field="*{usuario.sexo}"> H
                                    </label>
                                    <label class="btn btn-primary">
                                        <input type="radio" name="genero" id="genero_mujer" autocomplete="off" th:value="M" th:field="*{usuario.sexo}"> M
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="curp">CURP:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-pencil-square"></i></span>
                                <input type="text" class="form-control" placeholder="CURP" id="curp" name="curp" onkeypress="return sololetrasmayusculas(event, 'lblCurp')" autocomplete="off" th:field="*{usuario.curp}">
                            </div>
                            <label id="lblCurp" style="color: red; font-size: 14px; font-weight: bold; background-color: #ffebee; border-radius: 10px; display: block; margin-top: 5px;"></label>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="rol">Rol:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-dash-fill"></i></span>
                                <select class="form-select" aria-label="Default select example" name="rol.idrol" th:field="*{usuario.rol.idrol}">
                                    <option value="0">Selecciona un rol</option>
                                    <option th:each="rol: ${roles}" th:value="${rol.idrol}" th:text="${rol.nombre}" ></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="correo">Correo Electrónico:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-mailbox2"></i></span>
                                <input type="email" class="form-control" placeholder="confirmacion de correo" id="correo1" name="correo1"  pattern=".+@gmail\.com" size="40" required autocomplete="off">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="imagenFile" style="font-weight: bold; color: #333;">Imagen:</label>
                            <input type="file"  name="imagenFile" id="imagenFile" onchange="mostrarVistaPrevia()" style="border: 1px solid #ccc; padding: 5px; width: 100%;">
                        </div>
                    </div>
                    <div class="form-group">
                        <img id="vistaPrevia" th:if="${imagen != null}" th:src="${usuario.imagen}" alt="Vista previa" style="max-width: 100%; max-height: 300px; border: 2px solid #ccc; border-radius: 10px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);">
<!--                        <img id="vistaPrevia" th:unless="${imagen == null}" src="/imagen/User-icon.jpg" alt="Imagen por defecto" style="max-width: 100%; max-height: 300px; border: 2px solid #ccc; border-radius: 10px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);">-->
                    </div>
                </div>
                <br>
                <h1>Direccion</h1>
                <hr>
                <div class=" row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="correo">Calle:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-geo-alt-fill"></i></span>
                                <input type="text"  autocomplete="off" class="form-control" placeholder="Ingresa tu calle" id="calle" name="calle" th:field="*{direccion.calle}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="password">Número Exterior:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-house"></i></span>
                                <input type="text" autocomplete="off" class="form-control" placeholder="Numero Exterior" id="numeroexterior" name="numeroexterior" th:field="*{direccion.numeroexterior}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="telefono">Número Interior:</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-house-door-fill"></i></span>
                                <input type="tel" autocomplete="off" class="form-control" placeholder="Numero Interior" id="numerointerior" name="numerointerior" th:field="*{direccion.numerointerior}">
                            </div>
                        </div>
                    </div>
                    <!--                    <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="celular">Colonia:</label>
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text" id="basic-addon1"><i class="bi bi-geo-fill"></i></span>
                                                    <select class="form-select" aria-label="Default select example" name="colonia.idcolonia" th:field="*{direccion.colonia.idcolonia}">
                                                        <option value="0">Selecciona una colonia</option>
                                                        <option th:each="colonia: ${colonias}" th:value="${colonia.idcolonia}" th:text="${colonia.nombre}" ></option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>-->
                </div>
                <div class="row">
                    <div class="col-md-3 ">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-journal-bookmark-fill"></i></span>
                            <select class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.estado.pais.idpais" id="ddlPais" th:field="*{direccion.colonia.municipio.estado.pais.idpais}">
                                <option value="0">Seleccione un pais</option>
                                <option th:each="pais : ${paises}" th:value="${pais.idpais}" th:text="${pais.nombre}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 ">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-journal-bookmark-fill"></i></span>
                            <select th:if="${estados == null}"class="form-select" aria-label="Default select example" name="direccion.estado.idestado" id="ddlEstado" th:field="*{direccion.colonia.municipio.estado.idestado}">
                                <option value="0">Seleccione un estado</option>
                            </select>
                            <select th:unless="${estados == null}" class="form-select" aria-label="Default select example" name="direccion.estado.idestado" id="ddlEstado" th:field="*{direccion.colonia.municipio.estado.idestado}">
                                <option th:each="estado : ${estados}" th:value="${estado.idestado}" th:text="${estado.nombre}">Seleccione un estado</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 ">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-journal-bookmark-fill"></i></span>
                            <select th:if="${municipios == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.idmunicipio" id="ddlMunicipio" th:field="*{direccion.colonia.municipio.idmunicipio}">
                                <option value="0">Seleccione un municipio</option>
                            </select>
                            <select th:unless="${municipios == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.municipio.idmunicipio" id="ddlMunicipio" th:field="*{direccion.colonia.municipio.idmunicipio}">
                                <option th:each="municipio : ${municipios}" th:value="${municipio.idmunicipio}" th:text="${municipio.nombre}">Seleccione un municipio</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 ">
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-journal-bookmark-fill"></i></span>
                            <select th:if="${colonias == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.idcolonia" id="ddlColonia"  th:field="*{direccion.colonia.idcolonia}">
                                <option value="0">Seleccione un colonia</option>
                            </select>
                            <select th:unless="${colonias == null}" class="form-select" aria-label="Default select example" name="direccion.colonia.idcolonia" id="ddlColonia"  th:field="*{direccion.colonia.idcolonia}">
                                <option th:each="colonia : ${colonias}" th:value="${colonia.idcolonia}" th:text="${colonia.nombre}">Seleccione un colonia</option>
                            </select>
                        </div>
                    </div>
                </div>
                <br>
                <button type="submit" class="btn btn-outline-success col-md-12">Registrar</button>
                <br>
            </form>
        </div>
    </body>
</html>
<script>
    function sololetras(e, lbl) {

        var letters = /^[A-Za-z]+$/;
        var key = e.key;
        if (key.match(letters))
        {
            document.getElementById(lbl).innerHTML = "";
            return true;
        } else
        {
            document.getElementById(lbl).innerHTML = "Solo se aceptan letras";
            $("#" + lbl).css('color', 'red');
            return false;
        }
    }

    function sololetrasmayusculas(e, lbl) {

        var letters = /^[A-Z]+$/;
        var key = e.key;
        if (key.match(letters))
        {
            document.getElementById(lbl).innerHTML = "";
            return true;
        } else
        {
            document.getElementById(lbl).innerHTML = "Solo se aceptan letras mayusculas";
            $("#" + lbl).css('color', 'red');
            return false;
        }
    }

    function solonumeros(e, lbln) {

        var numbers = /^[0-9]+$/;
        var key = e.key;
        if (key.match(numbers))
        {
            document.getElementById(lbln).innerHTML = "";
            return true;
        } else
        {
            document.getElementById(lbln).innerHTML = "Solo se aceptan números";
            $("#" + lbln).css('color', 'red');
            return false;
        }
    }

    function numerosLongitud(e, lblnl) {

        var numbers = /^[0-9]+$/;
        var input = e.target.value;

        if (input.length === 10 && input.match(numbers))
        {
            document.getElementById(lblnl).innerHTML = "";
            return true;
        } else
        {
            document.getElementById(lblnl).innerHTML = "Ingresa exactamente 10 números";
            $("#" + lbl).css('color', 'red');
            return false;
        }
    }

    function validarCorreosIguales() {
        var correo = document.getElementById("correo").value;
        var correo1 = document.getElementById("correo1").value;

        if (correo !== correo1) {
            alert("Los correos electrónicos no coinciden");
            return false;
        }

        return true;
    }

    function validarInput(inputElement) {
        var valor = inputElement.value;

        // Verificar si la cadena tiene entre 1 y 10 caracteres
        if (valor.length >= 1 && valor.length <= 10) {
            // Utilizar una expresión regular para verificar que la cadena solo contiene letras mayúsculas, minúsculas y números
            var regex = /^[a-zA-Z0-9]+$/;
            if (!regex.test(valor)) {
                // La cadena contiene caracteres no permitidos
                alert("La cadena solo puede contener letras mayúsculas, minúsculas y números.");
                inputElement.value = ''; // Limpiar el valor del campo
            }
        } else {
            // La cadena tiene más de 10 caracteres o está vacía
            alert("La cadena debe tener entre 1 y 10 caracteres.");
            inputElement.value = ''; // Limpiar el valor del campo
        }
    }


    //JavaScript -- Jquery -- Ajax
    $(document).ready(function () {
        $("#ddlPais").change(function () {
            $.ajax({
                type: "GET",
                url: "/Usuario/GetEstadoByIdPais", // La URL del controlador
                dataType: "json",
                data: {IdPais: $("#ddlPais").val()},
                success: function (estados) {
                    $("#ddlEstado").empty();
                    $("#ddlEstado").append('<option value="0">' + 'Seleccione una estado' + '</option>');
                    $.each(estados, function (i, estado) {
                        $("#ddlEstado").append('<option value="'
                                + estado.idestado + '">'
                                + estado.nombre + '</option>');
                    });
                },
                error: function () {
                    alert("Error al obtener los datos.");
                }
            });
        });
    });
    $("#ddlEstado").change(function () {
        $.ajax({
            type: "GET",
            url: "/Usuario/GetMunicipioByIdEstado", // La URL del controlador
            dataType: "json",
            data: {IdEstado: $("#ddlEstado").val()},
            success: function (municipios) {
                $("#ddlMunicipio").empty();
                $("#ddlMunicipio").append('<option value="0">' + 'Seleccione una municipio' + '</option>');
                $.each(municipios, function (i, municipio) {
                    $("#ddlMunicipio").append('<option value="'
                            + municipio.idmunicipio + '">'
                            + municipio.nombre + '</option>');
                });
            },
            error: function () {
                alert("Error al obtener los datos.");
            }
        });
    });

    $("#ddlMunicipio").change(function () {
        $.ajax({
            type: "GET",
            url: "/Usuario/GetColoniaByIdMunicipio", // La URL del controlador
            dataType: "json",
            data: {IdMunicipio: $("#ddlMunicipio").val()},
            success: function (colonias) {
                $("#ddlColonia").empty();
                $("#ddlColonia").append('<option value="0">' + 'Seleccione una colonia' + '</option>');
                $.each(colonias, function (i, colonia) {
                    $("#ddlColonia").append('<option value="'
                            + colonia.idcolonia + '">'
                            + colonia.nombre + '</option>');
                });
            },
            error: function () {
                alert("Error al obtener los datos.");
            }
        });
    });

    function mostrarVistaPrevia() {
        var input = document.getElementById('imagenFile');
        var vistaPrevia = document.getElementById('vistaPrevia');
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                vistaPrevia.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

</script>

